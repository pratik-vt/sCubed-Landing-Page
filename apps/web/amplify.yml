version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 20
        - nvm use 20
        - yarn install --frozen-lockfile
    build:
      commands:
        - nvm use 20
        - yarn build:web
    postBuild:
      commands:
        - echo "Build completed successfully"
        - ls -la apps/web/.next
  artifacts:
    baseDirectory: apps/web/.next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .yarn/cache/**/*
      - apps/web/.next/cache/**/*

# Add this section to override start command
customHeaders:
  - pattern: '**'
    headers:
      - key: 'Custom-Start'
        value: 'cd apps/web && yarn start'
