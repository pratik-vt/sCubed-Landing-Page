version: 1
# Solution 1: Using appRoot (treats apps/web as application root)
appRoot: apps/web
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 20
        - nvm use 20
        - cd ../..
        - yarn install --frozen-lockfile
    build:
      commands:
        - nvm use 20
        - cd ../..
        - yarn build:web
    postBuild:
      commands:
        - echo "Build completed successfully"
        - ls -la .next
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - ../../node_modules/**/*
      - ../../.yarn/cache/**/*
      - .next/cache/**/*


# SETUP IN AMPLIFY CONSOLE:
# 1. Set App Root: apps/web
# 2. Deploy normally - start command is automatic 